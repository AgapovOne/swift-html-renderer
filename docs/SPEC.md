# SwiftHTMLRenderer — Specification

> Этот документ описывает **возможности** библиотеки: что она умеет, какие элементы поддерживает, как ведёт себя по умолчанию. Примеры кода и API — в README.

## Overview

SwiftHTMLRenderer рендерит HTML в нативные SwiftUI-вью. Предназначена для rich-text контента из API, CMS, документации.

Парсинг HTML — через [swift-lexbor](https://github.com/AgapovOne/swift-lexbor). Типы AST (`HTMLDocument`, `HTMLNode`, `HTMLElement`, `HTMLVisitor`) импортируются оттуда.

Библиотека **не рендерит веб-страницы целиком**. Только HTML-контент: статьи, комментарии, справка, форматированный текст.

## Platform

- iOS 17+
- Дополнительные платформы — позже

## Поведение по умолчанию

Рендерер работает из коробки. Пользователь переопределяет только то, что нужно.

### Inline collapsing

Phrasing content (`b`, `i`, `u`, `s`, `a`, `sub`, `sup`, `span`, `code`, `mark`, `small`, `kbd`, `q`, `cite`, `ins`, `abbr`, `br`) внутри блочного элемента схлопывается в **один** SwiftUI `Text`. Стили применяются через `AttributedString`, а не через вложенные views.

Если пользователь переопределяет inline-элемент через block View — рендерер переключается на отдельные views для этого блока. Inline-only кастомизация (через Text-трансформации) сохраняет collapsing.

### Ссылки

Ссылки (`<a href>`) кликабельны всегда — через `onLinkTap` callback или стандартный `OpenURLAction` из environment. Рендерятся как синий подчёркнутый текст.

### Неизвестные элементы

Неизвестные теги — пропускаются, дети рендерятся. Пользователь может переопределить поведение для неизвестных тегов.

### Интерактивность

Только чтение. Формы, инпуты, кнопки — не поддерживаются.

### Accessibility

- Заголовки (`h1`–`h6`) → header trait
- Ссылки (`a`) → link trait (при наличии URL)

Остальное — ответственность пользователя через кастомные рендереры.

## Кастомизация

Два уровня: ViewBuilder closures и Visitor protocol.

### ViewBuilder closures

Полный контроль над рендерингом конкретного элемента. Библиотека передаёт детей и атрибуты — пользователь возвращает любой View.

**Named renderers** — переопределение встроенных элементов: heading, paragraph, link, list, listItem, blockquote, codeBlock, table, definitionList, unknownElement.

**Tag-based renderers** — переопределение любого тега по имени. Три варианта:
- Block renderer — полная замена отрисовки тега на кастомный View
- Inline text renderer — трансформация Text внутри inline collapsing (сохраняет производительность)
- Block + inline — оба варианта одновременно

**Skip** — пропуск тега (рендерятся только дети).

**Link inline text** — кастомизация отображения ссылок внутри inline collapsing.

### Приоритет кастомизации

Если для одного элемента задано несколько уровней:
1. Named renderer — высший приоритет
2. Tag block renderer
3. Tag inline text
4. Built-in rendering
5. Unknown element handler

### Visitor protocol

Механизм обхода AST, не привязанный к рендерингу. Определён в swift-lexbor. Подходит для извлечения текста, сбора ссылок, трансформации дерева, экспорта в другие форматы.

## Supported HTML Elements (v1)

### Text

| Element | Поведение |
|---------|-----------|
| `h1` — `h6` | Заголовки с разными размерами шрифта |
| `p` | Параграф |
| `span` | Inline-контейнер (без стилей) |
| `br` | Перенос строки |
| `b`, `strong` | Жирный |
| `i`, `em` | Курсив |
| `u` | Подчёркивание |
| `s`, `del` | Зачёркивание |
| `a` | Ссылка (синяя, подчёркнутая, кликабельная) |
| `sub` | Подстрочный текст |
| `sup` | Надстрочный текст |
| `code` | Моноширинный шрифт |
| `mark` | Жёлтый фон |
| `small` | Мелкий текст |
| `kbd` | Моноширинный шрифт с рамкой |
| `q` | Кавычки вокруг текста |
| `cite` | Курсив |
| `ins` | Подчёркивание |
| `abbr` | Без визуальных изменений |

### Lists

| Element | Поведение |
|---------|-----------|
| `ul` | Маркированный список (буллеты) |
| `ol` | Нумерованный список |
| `li` | Элемент списка |

### Definition Lists

| Element | Поведение |
|---------|-----------|
| `dl` | Контейнер списка определений |
| `dt` | Термин (жирный) |
| `dd` | Определение (с отступом слева) |

### Tables

| Element | Поведение |
|---------|-----------|
| `table` | Таблица через SwiftUI Grid |
| `thead`, `tbody`, `tfoot` | Группировка строк |
| `tr` | Строка |
| `th` | Ячейка заголовка (жирный) |
| `td` | Ячейка данных |

Ограничение: `colspan` и `rowspan` не поддерживаются.

### Semantic Containers

| Element | Поведение |
|---------|-----------|
| `div`, `article`, `section`, `main`, `header`, `footer`, `nav`, `aside`, `figure` | Вертикальный стек с отступами |
| `figcaption` | Подпись мелким текстом |

### Code

| Element | Поведение |
|---------|-----------|
| `code` | Моноширинный шрифт (inline) |
| `pre` | Моноширинный шрифт, серый фон, скруглённые углы |

### Blockquote

| Element | Поведение |
|---------|-----------|
| `blockquote` | Отступ + вертикальная линия слева |

### Other

| Element | Поведение |
|---------|-----------|
| `hr` | Горизонтальная линия |

## Planned

Запланировано на будущие версии:

- Images (`img`) — требует дизайна: AsyncImage, placeholder, inline collapsing
- Details/Summary (`details`, `summary`)
- CSS parsing (inline, embedded, external)
- Forms и интерактивные элементы
- Дополнительные платформы (macOS, visionOS)
