{
  "project": "SwiftHTMLRenderer",
  "branchName": "ralph/renderer-fixes",
  "description": "HTMLRenderer quality fixes — deprecated API, remove init(html:), refactor monolithic switch",
  "userStories": [
    {
      "id": "US-001",
      "title": "Replace deprecated foregroundColor with foregroundStyle",
      "description": "As a library maintainer, I want to use modern SwiftUI API so that deprecation warnings don't appear in consumer projects.",
      "acceptanceCriteria": [
        "InlineTextBuilder.swift — foregroundColor(color) заменён на foregroundStyle(color) в функции applyStyles()",
        "Нет других вызовов foregroundColor() в модуле HTMLRenderer (проверить grep по Sources/HTMLRenderer/)",
        "Все тесты HTMLRendererTests проходят",
        "Билд без deprecation warnings",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Remove init(html:) from HTMLView",
      "description": "As a library designer, I want HTMLView to accept only pre-parsed HTMLDocument so that parsing responsibility is explicit and users control caching.",
      "acceptanceCriteria": [
        "Удалён init(html:, configuration:, onLinkTap:, onUnknownElement:) из HTMLView",
        "Удалён init(html:, configuration:, onLinkTap:, onUnknownElement:, content:) из HTMLView",
        "Остались только 2 инициализатора: init(document:, ...) и init(document:, ..., content:)",
        "Все тесты HTMLRendererTests обновлены: HTMLView(html: ...) заменены на HTMLView(document: HTMLParser.parseFragment(...))",
        "Библиотека компилируется без ошибок",
        "Все тесты проходят",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": "Breaking change. Библиотека pre-release — допустимо."
    },
    {
      "id": "US-003",
      "title": "Refactor ElementRenderer switch — extract inline elements",
      "description": "As a library developer, I want inline element rendering extracted into a dedicated method so that the main switch is shorter and easier to navigate.",
      "acceptanceCriteria": [
        "Inline-элементы (b, strong, i, em, u, s, del, code, span, abbr, mark, small, kbd, q, cite, ins, br, sub, sup) вынесены в private метод renderInlineElement() -> some View",
        "renderInlineElement() содержит свой switch по element.tagName для inline-тегов",
        "Главный switch вызывает renderInlineElement() одним case для всех inline-тегов",
        "Все тесты HTMLRendererTests проходят без изменений",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Refactor ElementRenderer switch — extract block, list, table, definition list",
      "description": "As a library developer, I want block, list, table, and definition list rendering extracted into dedicated methods so that the main switch contains only method calls.",
      "acceptanceCriteria": [
        "Block containers (div, article, section, main, header, footer, nav, aside) вынесены в private метод renderBlockContainer() -> some View",
        "List rendering: renderUnorderedList() и renderOrderedList() — отдельные private методы",
        "Table default rendering вынесен в private метод renderTableDefault() -> some View",
        "Definition list (dl, dt, dd) вынесен в private метод renderDefinitionList() -> some View",
        "Paragraph rendering вынесен в private метод renderParagraph() -> some View",
        "Blockquote rendering вынесен в private метод renderBlockquote() -> some View",
        "Pre rendering вынесен в private метод renderPreformatted() -> some View",
        "Figcaption rendering вынесен в private метод renderFigcaption() -> some View",
        "Главный switch содержит только вызовы методов, без inline-логики",
        "Все тесты HTMLRendererTests проходят без изменений",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": "Зависит от US-003 (inline уже вынесены)."
    },
    {
      "id": "US-005",
      "title": "Extract canCollapseInline pattern into helper method",
      "description": "As a library developer, I want the repeated canCollapseInline/buildInlineText pattern extracted into a single helper so that adding new elements with inline collapsing doesn't require copy-pasting.",
      "acceptanceCriteria": [
        "Создан private метод renderWithInlineCollapsing(style:defaultFont:) -> some View в ElementRenderer",
        "Метод внутри проверяет canCollapseInline(element.children, customRenderers:), вызывает buildInlineText() или renderChildren(), применяет applyStyle()",
        "Все 8 мест с паттерном if canCollapseInline { buildInlineText } else { renderChildren() } заменены на вызов renderWithInlineCollapsing()",
        "Затронутые элементы: p, h1-h6, figcaption, th, td, dt, dd, li (в renderListItemContent)",
        "Все тесты HTMLRendererTests проходят без изменений",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": "Зависит от US-003 и US-004 (switch уже разбит на методы). Некоторые вызовы canCollapseInline имеют дополнительные модификаторы (.bold(), .padding) — helper должен поддерживать это через дополнительные параметры или применение модификаторов снаружи."
    }
  ]
}
